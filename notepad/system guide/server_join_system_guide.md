# 서버 입장 시스템 사용 가이드

## 개요

서버 입장 시스템은 봇이 새로운 서버에 초대되었을 때 자동으로 환영 메시지를 보내고, 서버 입장/퇴장 기록을 데이터베이스에 저장하는 기능입니다. 이 시스템을 통해 DB와 봇이 정상적으로 동작하는지 확인할 수 있습니다.

## 기능

1. **서버 입장 감지**: 봇이 새로운 서버에 초대되면 자동으로 감지합니다.
2. **환영 메시지 전송**: 서버의 상태(신규/기존)에 따라 적절한 환영 메시지를 전송합니다.
3. **서버 기록 저장**: 봇의 서버 입장/퇴장 기록을 데이터베이스에 저장합니다.
4. **초대자 정보 저장**: 봇을 초대한 사용자 정보를 데이터베이스에 저장합니다.

## 데이터베이스 설정

1. PostgreSQL 데이터베이스에 필요한 테이블을 생성하기 위해 다음 명령어를 실행합니다:

```bash
psql -U bot_user -d hyolssdb -f db_setup.sql
```

또는 PostgreSQL 관리 도구(예: pgAdmin)에서 `db_setup.sql` 파일의 내용을 실행할 수도 있습니다.

## 테스트 방법

1. 봇을 실행합니다:

```bash
node index.js
```

2. 봇을 새로운 Discord 서버에 초대합니다.
3. 봇이 자동으로 환영 메시지를 보내는지 확인합니다.
4. 봇을 서버에서 제거한 후 다시 초대하여 재입장 메시지가 표시되는지 확인합니다.

## 데이터베이스 테이블 구조

### bot_server_history

봇의 서버 입장/퇴장 기록을 저장하는 테이블입니다.

| 필드 | 타입 | 설명 |
|------|------|------|
| id | SERIAL | 기본 키 |
| guild_id | VARCHAR(20) | 서버 ID |
| first_join_date | TIMESTAMP | 최초 입장 날짜 |
| last_leave_date | TIMESTAMP | 마지막 퇴장 날짜 |
| join_count | INTEGER | 총 입장 횟수 |
| current_status | BOOLEAN | 현재 입장 상태 |

### bot_inviter_tracking

봇을 초대한 사용자 정보를 저장하는 테이블입니다.

| 필드 | 타입 | 설명 |
|------|------|------|
| id | SERIAL | 기본 키 |
| inviter_id | VARCHAR(20) | 초대한 유저 ID |
| guild_id | VARCHAR(20) | 서버 ID |
| invite_date | TIMESTAMP | 초대 날짜 |

## 구현된 파일

1. **events/guildCreate.js**: 봇이 서버에 입장했을 때 실행되는 이벤트 핸들러
2. **events/guildDelete.js**: 봇이 서버에서 퇴장했을 때 실행되는 이벤트 핸들러
3. **db_setup.sql**: 데이터베이스 테이블 생성 스크립트

## 주의사항

- Discord API의 제한으로 인해 정확한 초대자 정보를 가져오기 어려울 수 있습니다. 현재 구현에서는 서버 소유자를 초대자로 가정합니다.
- 봇이 서버에 입장할 때 메시지를 보낼 적절한 채널을 찾지 못할 경우, 메시지가 전송되지 않을 수 있습니다.